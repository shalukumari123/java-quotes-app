trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

variables:
  dockerRegistryServiceConnection: 'dockerhub-service-connection'   # your service connection name dockerhub-service=connection
  imageName: 'shalukumari123/java-app'

steps:
- checkout: self


- task: Bash@3
  displayName: Compile Java App
  inputs:
    targetType: 'inline'
    script: |
      echo "Compiling Java app..."
      mkdir -p build
      javac -d build src/Main.java
      echo "Compilation successful."

- task: Docker@2
  displayName: Login to DockerHub
  inputs:
    command: login
    containerRegistry: $(dockerRegistryServiceConnection)

- task: Docker@2
  displayName: Build and Push Docker Image
  inputs:
    command: buildAndPush
    containerRegistry: $(dockerRegistryServiceConnection)
    repository: $(imageName)
    dockerfile: '$(Build.SourcesDirectory)/Dockerfile'   # absolute path to Dockerfile
    buildContext: '$(Build.SourcesDirectory)'            # <--- this is key!
    tags: |
      $(Build.BuildId)
      latest
